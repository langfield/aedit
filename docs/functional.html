<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ki.functional API documentation</title>
<meta name="description" content="Type-safe, non Anki-specific functions." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="ki/functional.html">
<link rel="icon" href="u1F367-shavedice.svg">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ki.functional</code></h1>
</header>
<section id="section-intro">
<p>Type-safe, non Anki-specific functions.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3
&#34;&#34;&#34;Type-safe, non Anki-specific functions.&#34;&#34;&#34;

# pylint: disable=import-self, too-many-return-statements
# pylint: disable=no-value-for-parameter

import os
import re
import sys
import stat
import errno
import shutil
import hashlib
import tempfile
import functools
import subprocess
import unicodedata
from types import TracebackType
from pathlib import Path
from itertools import chain
from functools import reduce, partial, update_wrapper, wraps

import git
from tqdm import tqdm
from colorama import Fore, Style

from beartype import beartype
from beartype.typing import (
    List,
    Union,
    Generator,
    Tuple,
    Callable,
    Any,
    Type,
    FrozenSet,
    Iterable,
    TypeVar,
)

import ki.functional as F
from ki.types import (
    File,
    Dir,
    EmptyDir,
    NoPath,
    NoFile,
    Link,
    WindowsLink,
    Singleton,
    PseudoFile,
    KiRev,
    Rev,
)

_has_type_hint_support = sys.version_info[:2] &gt;= (3, 5)

T = TypeVar(&#34;T&#34;)

UTF8 = &#34;UTF-8&#34;
GIT = &#34;.git&#34;
GITMODULES_FILE = &#34;.gitmodules&#34;
PIPE = subprocess.PIPE
STDOUT = subprocess.STDOUT
BRANCH_NAME = &#34;main&#34;

# Emoji regex character classes.
EMOJIS = &#34;\U0001F600-\U0001F64F&#34;
PICTOGRAPHS = &#34;\U0001F300-\U0001F5FF&#34;
TRANSPORTS = &#34;\U0001F680-\U0001F6FF&#34;
FLAGS = &#34;\U0001F1E0-\U0001F1FF&#34;

# Regex to filter out bad stuff from filenames.
SLUG_REGEX = re.compile(r&#34;[^\w\s\-&#34; + EMOJIS + PICTOGRAPHS + TRANSPORTS + FLAGS + &#34;]&#34;)


@beartype
def curried(func: Callable[[Any, ...], T]) -&gt; Callable[[Any, ...], T]:
    &#34;&#34;&#34;A decorator that makes the function curried

    Usage example:

    &gt;&gt;&gt; @curried
    ... def sum5(a, b, c, d, e):
    ...     return a + b + c + d + e
    ...
    &gt;&gt;&gt; sum5(1)(2)(3)(4)(5)
    15
    &gt;&gt;&gt; sum5(1, 2, 3)(4, 5)
    15
    &#34;&#34;&#34;

    def _args_len(func):
        # pylint: disable=import-outside-toplevel
        good = True
        try:
            from inspect import signature

            signature(func)
        except TypeError:
            good = False

        if good and _has_type_hint_support:
            from inspect import signature

            args = signature(func).parameters
        else:
            from inspect import getfullargspec

            args = getfullargspec(func).args

        return len(args)

    @wraps(func)
    def _curried(*args, **kwargs):
        f = func
        count = 0
        while isinstance(f, partial):
            if f.args:
                count += len(f.args)
            f = f.func

        if count == _args_len(f) - len(args):
            return func(*args, **kwargs)

        para_func = partial(func, *args, **kwargs)
        if hasattr(f, &#34;__name__&#34;):
            update_wrapper(para_func, f)
        return curried(para_func)

    def _curried_lambda(*args, **kwargs):
        return partial(func, *args, **kwargs)

    if func.__name__ == &#34;&lt;lambda&gt;&#34;:
        return _curried_lambda

    return _curried


def rmtree2(path: str) -&gt; None:
    &#34;&#34;&#34;On windows, rmtree fails for readonly dirs.&#34;&#34;&#34;

    def handle_remove_readonly(
        func: Callable[..., Any],
        path: str,
        exc: Tuple[Type[OSError], OSError, TracebackType],
    ) -&gt; None:
        excvalue = exc[1]
        if func in (os.rmdir, os.remove, os.unlink) and excvalue.errno == errno.EACCES:
            for p in (path, os.path.dirname(path)):
                os.chmod(p, os.stat(p).st_mode | stat.S_IWUSR)
            func(path)
        else:
            raise excvalue

    shutil.rmtree(path, ignore_errors=False, onerror=handle_remove_readonly)


@beartype
def rmtree(target: Dir) -&gt; NoFile:
    &#34;&#34;&#34;Equivalent to `shutil.rmtree()`, but annihilates read-only files on Windows.&#34;&#34;&#34;
    rmtree2(str(target))
    return NoFile(target)


@beartype
def copytree(source: Dir, target: NoFile) -&gt; Dir:
    &#34;&#34;&#34;Call shutil.copytree().&#34;&#34;&#34;
    shutil.copytree(source, target, symlinks=True)
    return Dir(target.resolve())


@beartype
def movetree(source: Dir, target: NoFile) -&gt; Dir:
    &#34;&#34;&#34;Call shutil.move().&#34;&#34;&#34;
    shutil.move(source, target)
    return Dir(target.resolve())


@beartype
def cwd() -&gt; Dir:
    &#34;&#34;&#34;Call Path.cwd().&#34;&#34;&#34;
    return Dir(Path.cwd().resolve())


@beartype
def is_root(path: Union[File, Dir]) -&gt; bool:
    &#34;&#34;&#34;Check if &#39;path&#39; is a root directory (e.g., &#39;/&#39; on Unix or &#39;C:\&#39; on Windows).&#34;&#34;&#34;
    # Links and `~`s are resolved before checking.
    path = path.resolve()
    return len(path.parents) == 0


@functools.cache
@beartype
def shallow_walk(
    directory: Dir,
) -&gt; Tuple[Dir, List[Dir], List[File]]:
    &#34;&#34;&#34;Walk only the top-level directory with `os.walk()`.&#34;&#34;&#34;
    # pylint: disable=redefined-outer-name
    root, dirs, files = next(os.walk(directory))
    root = Dir(root)
    dirs = [Dir(root / d) for d in dirs]
    # TODO: Treat symlinks.
    files = [File(root / f) for f in files]
    return root, dirs, files


@beartype
def walk(
    directory: Dir,
) -&gt; FrozenSet[Union[File, PseudoFile, Link, NoFile]]:
    &#34;&#34;&#34;Get all file-like leaves in a directory, recursively.&#34;&#34;&#34;
    # pylint: disable=redefined-outer-name
    leaves = frozenset()
    for root, _, files in os.walk(directory):
        root = Dir(root)
        leaves |= frozenset({F.chk(root / f) for f in files})
    return leaves


# TODO: Remove `resolve: bool` parameter, and test symlinks before resolving.
@beartype
def chk(
    path: Path,
    resolve: bool = True,
) -&gt; Union[File, Dir, EmptyDir, PseudoFile, NoPath, NoFile, Link]:
    &#34;&#34;&#34;Test whether `path` is a file, a directory, or something else.&#34;&#34;&#34;
    if resolve:
        path = path.resolve()
    if path.is_file():
        return File(path)
    if path.is_dir():
        if is_empty(Dir(path)):
            return EmptyDir(path)
        return Dir(path)
    if path.exists():
        return PseudoFile(path)
    if os.path.islink(path):
        return Link(path)
    if path.parent.is_dir():
        return NoFile(path)
    return NoPath(path)


@beartype
def touch(directory: Dir, name: str) -&gt; File:
    &#34;&#34;&#34;Touch a file.&#34;&#34;&#34;
    path = directory / singleton(name)
    path.touch()
    return File(path.resolve())


@beartype
def write(path: Union[File, NoFile], text: str) -&gt; File:
    &#34;&#34;&#34;Write text to a file.&#34;&#34;&#34;
    with open(path, &#34;w+&#34;, encoding=&#34;UTF-8&#34;) as f:
        f.write(text)
    return File(path)


@beartype
def writeb(path: Union[File, NoFile], bs: bytes) -&gt; File:
    &#34;&#34;&#34;Write text to a file.&#34;&#34;&#34;
    with open(path, &#34;wb&#34;) as f:
        f.write(bs)
    return File(path)


@beartype
def symlink(path: NoFile, target: Path) -&gt; Union[Link, WindowsLink]:
    &#34;&#34;&#34;Link `path` to `target`.&#34;&#34;&#34;
    if sys.platform == &#34;win32&#34;:
        with open(path, &#34;w&#34;, encoding=&#34;UTF-8&#34;) as f:
            f.write(str(target.as_posix()))
            return WindowsLink(path)

    # Treat POSIX systems.
    os.symlink(target, path)
    return Link(path)


@beartype
def mksubdir(directory: EmptyDir, suffix: Path) -&gt; EmptyDir:
    &#34;&#34;&#34;
    Make a subdirectory of an empty directory (with parents).

    Returns
    -------
    EmptyDir
        The created subdirectory.
    &#34;&#34;&#34;
    subdir = directory / suffix
    subdir.mkdir(parents=True)
    directory.__class__ = Dir
    return EmptyDir(subdir.resolve())


@beartype
def force_mkdir(path: Path) -&gt; Dir:
    &#34;&#34;&#34;Make a directory (with parents, ok if it already exists).&#34;&#34;&#34;
    path.mkdir(parents=True, exist_ok=True)
    return Dir(path.resolve())


@beartype
def chdir(directory: Dir) -&gt; Dir:
    &#34;&#34;&#34;Changes working directory and returns old cwd.&#34;&#34;&#34;
    old: Dir = F.cwd()
    os.chdir(directory)
    return old


@beartype
def parent(path: Union[File, Dir]) -&gt; Dir:
    &#34;&#34;&#34;
    Get the parent of a path that exists.  If the path points to the filesystem
    root, we return itself.
    &#34;&#34;&#34;
    if is_root(path):
        return Dir(path.resolve())
    return Dir(path.parent)


@beartype
def mkdtemp() -&gt; EmptyDir:
    &#34;&#34;&#34;Make a temporary directory (in /tmp).&#34;&#34;&#34;
    return EmptyDir(tempfile.mkdtemp()).resolve()


@beartype
def copyfile(source: File, target: Union[File, NoFile]) -&gt; File:
    &#34;&#34;&#34;Safely copy a file to a valid location.&#34;&#34;&#34;
    shutil.copyfile(source, target)
    return File(target.resolve())


@beartype
def rglob(d: Dir, pattern: str) -&gt; List[File]:
    &#34;&#34;&#34;Call d.rglob() and returns only files.&#34;&#34;&#34;
    files = filter(lambda p: isinstance(p, File), map(F.chk, d.rglob(pattern)))
    return list(files)


@beartype
def is_empty(directory: Dir) -&gt; bool:
    &#34;&#34;&#34;Check if directory is empty, quickly.&#34;&#34;&#34;
    return not next(os.scandir(directory), None)


@beartype
def root(repo: git.Repo) -&gt; Dir:
    &#34;&#34;&#34;Get working directory of a repo.&#34;&#34;&#34;
    return Dir(repo.working_dir).resolve()


@beartype
def gitd(repo: git.Repo) -&gt; Dir:
    &#34;&#34;&#34;Get git directory of a repo.&#34;&#34;&#34;
    return Dir(repo.git_dir).resolve()


@beartype
def singleton(name: str) -&gt; Singleton:
    &#34;&#34;&#34;Removes all forward slashes and returns a Singleton pathlib.Path.&#34;&#34;&#34;
    return Singleton(name.replace(&#34;/&#34;, &#34;&#34;))


@beartype
def md5(path: File) -&gt; str:
    &#34;&#34;&#34;Compute md5sum of file at `path`.&#34;&#34;&#34;
    hash_md5 = hashlib.md5()
    with open(path, &#34;rb&#34;) as f:
        for chunk in iter(lambda: f.read(4096), b&#34;&#34;):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()


@beartype
def rev_exists(repo: git.Repo, rev: str) -&gt; bool:
    &#34;&#34;&#34;Check if git commit reference exists in repository.&#34;&#34;&#34;
    try:
        repo.git.rev_parse(&#34;--verify&#34;, rev)
    except git.GitCommandError:
        return False
    return True


@beartype
def get_batches(lst: List[File], n: int) -&gt; Generator[File, None, None]:
    &#34;&#34;&#34;Yield successive n-sized chunks from lst.&#34;&#34;&#34;
    for i in range(0, len(lst), n):
        yield lst[i : i + n]


@beartype
def slugify(value: str) -&gt; str:
    &#34;&#34;&#34;
    Taken from [1]. Convert spaces or repeated dashes to single dashes. Remove
    characters that aren&#39;t alphanumerics, underscores, or hyphens. Convert to
    lowercase. Also strip leading and trailing whitespace, dashes, and
    underscores.

    [1] https://github.com/django/django/blob/master/django/utils/text.py
    &#34;&#34;&#34;
    value = unicodedata.normalize(&#34;NFKC&#34;, value)
    value = re.sub(SLUG_REGEX, &#34;&#34;, value.lower())
    return re.sub(r&#34;[-\s]+&#34;, &#34;-&#34;, value).strip(&#34;-_&#34;)


@beartype
def ki_rev_to_rev(ki_rev: KiRev) -&gt; Rev:
    &#34;&#34;&#34;Convert a ki repository commit rev to a git repository commit rev.&#34;&#34;&#34;
    return Rev(ki_rev.kirepo.repo, ki_rev.sha)


@beartype
def mkdir(path: NoPath) -&gt; EmptyDir:
    &#34;&#34;&#34;Make a directory (with parents).&#34;&#34;&#34;
    path.mkdir(parents=True)
    return EmptyDir(path)


@beartype
def unlink(file: Union[File, Link, WindowsLink]) -&gt; NoFile:
    &#34;&#34;&#34;Safely unlink a file.&#34;&#34;&#34;
    os.unlink(file)
    return NoFile(file)


@curried
@beartype
def rmsm(repo: git.Repo, sm: git.Submodule) -&gt; git.Commit:
    &#34;&#34;&#34;Remove a git submodule.&#34;&#34;&#34;
    # Remove the submodule root and delete its .git directory.
    sm_root = Path(sm.module().working_tree_dir)
    repo.git.rm(sm_root, cached=True)
    dotgit = F.chk(sm_root / GIT)
    if isinstance(dotgit, Dir):
        F.rmtree(dotgit)
    else:
        dotgit.unlink(missing_ok=True)

    # Directory `sm_root` should still exist after `git.rm()` call.
    repo.git.add(sm_root)
    return repo.index.commit(f&#34;Add submodule `{sm.name}` as ordinary directory.&#34;)


@beartype
def unsubmodule(repo: git.Repo) -&gt; git.Repo:
    &#34;&#34;&#34;
    Un-submodule all the git submodules (converts them to ordinary subdirs and
    destroys commit history). Commit the changes to the main repository.
    &#34;&#34;&#34;
    _: List[git.Commit] = list(map(F.rmsm(repo), repo.submodules))
    gitmodules_file: Path = F.root(repo) / GITMODULES_FILE
    if gitmodules_file.exists():
        repo.git.rm(gitmodules_file)
        _ = repo.index.commit(&#34;Remove `.gitmodules` file.&#34;)
    return repo


@beartype
def init(targetdir: Dir) -&gt; Tuple[git.Repo, str]:
    &#34;&#34;&#34;Run `git init`, returning the repo and initial branch name.&#34;&#34;&#34;
    branch = BRANCH_NAME
    try:
        repo = git.Repo.init(targetdir, initial_branch=BRANCH_NAME)
    except git.GitCommandError:
        branch = &#34;master&#34;
        repo = git.Repo.init(targetdir)
    return repo, branch


@beartype
def isfile(p: Path) -&gt; bool:
    &#34;&#34;&#34;Check if `p` is a File.&#34;&#34;&#34;
    return isinstance(p, File)


@beartype
def cat(xs: Iterable[Iterable[T]]) -&gt; Iterable[T]:
    &#34;&#34;&#34;Concatenate some iterables.&#34;&#34;&#34;
    return chain.from_iterable(xs)


@beartype
def commitall(repo: git.Repo, msg: str) -&gt; git.Commit:
    &#34;&#34;&#34;Commit all contents of a git repository.&#34;&#34;&#34;
    repo.git.add(all=True)
    return repo.index.commit(msg)


@curried
@beartype
def git_rm(repo: git.Repo, path: str) -&gt; str:
    &#34;&#34;&#34;Remove a path in a repo.&#34;&#34;&#34;
    repo.git.rm(path)
    return path


@beartype
def yellow(s: str) -&gt; None:
    &#34;&#34;&#34;Print a message to the console in yellow.&#34;&#34;&#34;
    print(f&#34;{Fore.YELLOW}{s}{Style.RESET_ALL}&#34;)


@beartype
def red(s: str) -&gt; None:
    &#34;&#34;&#34;Print a message to the console in red.&#34;&#34;&#34;
    print(f&#34;{Fore.RED}{s}{Style.RESET_ALL}&#34;)


@beartype
def progressbar(xs: Iterable[T], s: str) -&gt; Iterable[T]:
    &#34;&#34;&#34;Print a progress bar for an iterable.&#34;&#34;&#34;
    ys: Iterable[T] = tqdm(xs, ncols=80)
    ys.set_description(s)
    return ys


@beartype
def starfilter(
    f: Callable[[Any, ...], bool], xs: Iterable[Tuple[Any, ...]]
) -&gt; Iterable[Tuple[Any, ...]]:
    &#34;&#34;&#34;Filter an iterable, automatically unpacking tuple arguments.&#34;&#34;&#34;
    return filter(lambda x: f(*x), xs)


@beartype
def part(p: Callable[[T], bool], xs: Iterable[T]) -&gt; Tuple[Iterable[T], Iterable[T]]:
    &#34;&#34;&#34;Partition a list on a boolean predicate (Trues, Falses).&#34;&#34;&#34;
    return reduce(lambda s, x: s[not p(x)].append(x) or s, xs, ([], []))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ki.functional.cat"><code class="name flex">
<span>def <span class="ident">cat</span></span>(<span>xs: collections.abc.Iterable[collections.abc.Iterable[~T]]) ‑> collections.abc.Iterable[~T]</span>
</code></dt>
<dd>
<div class="desc"><p>Concatenate some iterables.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def cat(xs: Iterable[Iterable[T]]) -&gt; Iterable[T]:
    &#34;&#34;&#34;Concatenate some iterables.&#34;&#34;&#34;
    return chain.from_iterable(xs)</code></pre>
</details>
</dd>
<dt id="ki.functional.chdir"><code class="name flex">
<span>def <span class="ident">chdir</span></span>(<span>directory: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Changes working directory and returns old cwd.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def chdir(directory: Dir) -&gt; Dir:
    &#34;&#34;&#34;Changes working directory and returns old cwd.&#34;&#34;&#34;
    old: Dir = F.cwd()
    os.chdir(directory)
    return old</code></pre>
</details>
</dd>
<dt id="ki.functional.chk"><code class="name flex">
<span>def <span class="ident">chk</span></span>(<span>path: pathlib.Path, resolve: bool = True) ‑> Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, <a title="ki.types.EmptyDir" href="types.html#ki.types.EmptyDir">EmptyDir</a>, <a title="ki.types.PseudoFile" href="types.html#ki.types.PseudoFile">PseudoFile</a>, <a title="ki.types.NoPath" href="types.html#ki.types.NoPath">NoPath</a>, <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>, <a title="ki.types.Link" href="types.html#ki.types.Link">Link</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Test whether <code>path</code> is a file, a directory, or something else.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def chk(
    path: Path,
    resolve: bool = True,
) -&gt; Union[File, Dir, EmptyDir, PseudoFile, NoPath, NoFile, Link]:
    &#34;&#34;&#34;Test whether `path` is a file, a directory, or something else.&#34;&#34;&#34;
    if resolve:
        path = path.resolve()
    if path.is_file():
        return File(path)
    if path.is_dir():
        if is_empty(Dir(path)):
            return EmptyDir(path)
        return Dir(path)
    if path.exists():
        return PseudoFile(path)
    if os.path.islink(path):
        return Link(path)
    if path.parent.is_dir():
        return NoFile(path)
    return NoPath(path)</code></pre>
</details>
</dd>
<dt id="ki.functional.commitall"><code class="name flex">
<span>def <span class="ident">commitall</span></span>(<span>repo: git.repo.base.Repo, msg: str) ‑> git.objects.commit.Commit</span>
</code></dt>
<dd>
<div class="desc"><p>Commit all contents of a git repository.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def commitall(repo: git.Repo, msg: str) -&gt; git.Commit:
    &#34;&#34;&#34;Commit all contents of a git repository.&#34;&#34;&#34;
    repo.git.add(all=True)
    return repo.index.commit(msg)</code></pre>
</details>
</dd>
<dt id="ki.functional.copyfile"><code class="name flex">
<span>def <span class="ident">copyfile</span></span>(<span>source: <a title="ki.types.File" href="types.html#ki.types.File">File</a>, target: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>]) ‑> <a title="ki.types.File" href="types.html#ki.types.File">File</a></span>
</code></dt>
<dd>
<div class="desc"><p>Safely copy a file to a valid location.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def copyfile(source: File, target: Union[File, NoFile]) -&gt; File:
    &#34;&#34;&#34;Safely copy a file to a valid location.&#34;&#34;&#34;
    shutil.copyfile(source, target)
    return File(target.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.copytree"><code class="name flex">
<span>def <span class="ident">copytree</span></span>(<span>source: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, target: <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Call shutil.copytree().</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def copytree(source: Dir, target: NoFile) -&gt; Dir:
    &#34;&#34;&#34;Call shutil.copytree().&#34;&#34;&#34;
    shutil.copytree(source, target, symlinks=True)
    return Dir(target.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.curried"><code class="name flex">
<span>def <span class="ident">curried</span></span>(<span>func: collections.abc.Callable[[typing.Any, ...], ~T]) ‑> collections.abc.Callable[[typing.Any, ...], ~T]</span>
</code></dt>
<dd>
<div class="desc"><p>A decorator that makes the function curried</p>
<p>Usage example:</p>
<pre><code class="language-python-repl">&gt;&gt;&gt; @curried
... def sum5(a, b, c, d, e):
...     return a + b + c + d + e
...
&gt;&gt;&gt; sum5(1)(2)(3)(4)(5)
15
&gt;&gt;&gt; sum5(1, 2, 3)(4, 5)
15
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def curried(func: Callable[[Any, ...], T]) -&gt; Callable[[Any, ...], T]:
    &#34;&#34;&#34;A decorator that makes the function curried

    Usage example:

    &gt;&gt;&gt; @curried
    ... def sum5(a, b, c, d, e):
    ...     return a + b + c + d + e
    ...
    &gt;&gt;&gt; sum5(1)(2)(3)(4)(5)
    15
    &gt;&gt;&gt; sum5(1, 2, 3)(4, 5)
    15
    &#34;&#34;&#34;

    def _args_len(func):
        # pylint: disable=import-outside-toplevel
        good = True
        try:
            from inspect import signature

            signature(func)
        except TypeError:
            good = False

        if good and _has_type_hint_support:
            from inspect import signature

            args = signature(func).parameters
        else:
            from inspect import getfullargspec

            args = getfullargspec(func).args

        return len(args)

    @wraps(func)
    def _curried(*args, **kwargs):
        f = func
        count = 0
        while isinstance(f, partial):
            if f.args:
                count += len(f.args)
            f = f.func

        if count == _args_len(f) - len(args):
            return func(*args, **kwargs)

        para_func = partial(func, *args, **kwargs)
        if hasattr(f, &#34;__name__&#34;):
            update_wrapper(para_func, f)
        return curried(para_func)

    def _curried_lambda(*args, **kwargs):
        return partial(func, *args, **kwargs)

    if func.__name__ == &#34;&lt;lambda&gt;&#34;:
        return _curried_lambda

    return _curried</code></pre>
</details>
</dd>
<dt id="ki.functional.cwd"><code class="name flex">
<span>def <span class="ident">cwd</span></span>(<span>) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Call Path.cwd().</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def cwd() -&gt; Dir:
    &#34;&#34;&#34;Call Path.cwd().&#34;&#34;&#34;
    return Dir(Path.cwd().resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.force_mkdir"><code class="name flex">
<span>def <span class="ident">force_mkdir</span></span>(<span>path: pathlib.Path) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Make a directory (with parents, ok if it already exists).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def force_mkdir(path: Path) -&gt; Dir:
    &#34;&#34;&#34;Make a directory (with parents, ok if it already exists).&#34;&#34;&#34;
    path.mkdir(parents=True, exist_ok=True)
    return Dir(path.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.get_batches"><code class="name flex">
<span>def <span class="ident">get_batches</span></span>(<span>lst: list[<a title="ki.types.File" href="types.html#ki.types.File">File</a>], n: int) ‑> collections.abc.Generator[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, None, None]</span>
</code></dt>
<dd>
<div class="desc"><p>Yield successive n-sized chunks from lst.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def get_batches(lst: List[File], n: int) -&gt; Generator[File, None, None]:
    &#34;&#34;&#34;Yield successive n-sized chunks from lst.&#34;&#34;&#34;
    for i in range(0, len(lst), n):
        yield lst[i : i + n]</code></pre>
</details>
</dd>
<dt id="ki.functional.git_rm"><code class="name flex">
<span>def <span class="ident">git_rm</span></span>(<span>repo: git.repo.base.Repo, path: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Remove a path in a repo.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@curried
@beartype
def git_rm(repo: git.Repo, path: str) -&gt; str:
    &#34;&#34;&#34;Remove a path in a repo.&#34;&#34;&#34;
    repo.git.rm(path)
    return path</code></pre>
</details>
</dd>
<dt id="ki.functional.gitd"><code class="name flex">
<span>def <span class="ident">gitd</span></span>(<span>repo: git.repo.base.Repo) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Get git directory of a repo.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def gitd(repo: git.Repo) -&gt; Dir:
    &#34;&#34;&#34;Get git directory of a repo.&#34;&#34;&#34;
    return Dir(repo.git_dir).resolve()</code></pre>
</details>
</dd>
<dt id="ki.functional.init"><code class="name flex">
<span>def <span class="ident">init</span></span>(<span>targetdir: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> tuple[git.repo.base.Repo, str]</span>
</code></dt>
<dd>
<div class="desc"><p>Run <code>git <a title="ki.functional.init" href="#ki.functional.init">init()</a></code>, returning the repo and initial branch name.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def init(targetdir: Dir) -&gt; Tuple[git.Repo, str]:
    &#34;&#34;&#34;Run `git init`, returning the repo and initial branch name.&#34;&#34;&#34;
    branch = BRANCH_NAME
    try:
        repo = git.Repo.init(targetdir, initial_branch=BRANCH_NAME)
    except git.GitCommandError:
        branch = &#34;master&#34;
        repo = git.Repo.init(targetdir)
    return repo, branch</code></pre>
</details>
</dd>
<dt id="ki.functional.is_empty"><code class="name flex">
<span>def <span class="ident">is_empty</span></span>(<span>directory: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Check if directory is empty, quickly.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def is_empty(directory: Dir) -&gt; bool:
    &#34;&#34;&#34;Check if directory is empty, quickly.&#34;&#34;&#34;
    return not next(os.scandir(directory), None)</code></pre>
</details>
</dd>
<dt id="ki.functional.is_root"><code class="name flex">
<span>def <span class="ident">is_root</span></span>(<span>path: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>]) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Check if 'path' is a root directory (e.g., '/' on Unix or 'C:' on Windows).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def is_root(path: Union[File, Dir]) -&gt; bool:
    &#34;&#34;&#34;Check if &#39;path&#39; is a root directory (e.g., &#39;/&#39; on Unix or &#39;C:\&#39; on Windows).&#34;&#34;&#34;
    # Links and `~`s are resolved before checking.
    path = path.resolve()
    return len(path.parents) == 0</code></pre>
</details>
</dd>
<dt id="ki.functional.isfile"><code class="name flex">
<span>def <span class="ident">isfile</span></span>(<span>p: pathlib.Path) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Check if <code>p</code> is a File.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def isfile(p: Path) -&gt; bool:
    &#34;&#34;&#34;Check if `p` is a File.&#34;&#34;&#34;
    return isinstance(p, File)</code></pre>
</details>
</dd>
<dt id="ki.functional.ki_rev_to_rev"><code class="name flex">
<span>def <span class="ident">ki_rev_to_rev</span></span>(<span>ki_rev: <a title="ki.types.KiRev" href="types.html#ki.types.KiRev">KiRev</a>) ‑> <a title="ki.types.Rev" href="types.html#ki.types.Rev">Rev</a></span>
</code></dt>
<dd>
<div class="desc"><p>Convert a ki repository commit rev to a git repository commit rev.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def ki_rev_to_rev(ki_rev: KiRev) -&gt; Rev:
    &#34;&#34;&#34;Convert a ki repository commit rev to a git repository commit rev.&#34;&#34;&#34;
    return Rev(ki_rev.kirepo.repo, ki_rev.sha)</code></pre>
</details>
</dd>
<dt id="ki.functional.md5"><code class="name flex">
<span>def <span class="ident">md5</span></span>(<span>path: <a title="ki.types.File" href="types.html#ki.types.File">File</a>) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Compute md5sum of file at <code>path</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def md5(path: File) -&gt; str:
    &#34;&#34;&#34;Compute md5sum of file at `path`.&#34;&#34;&#34;
    hash_md5 = hashlib.md5()
    with open(path, &#34;rb&#34;) as f:
        for chunk in iter(lambda: f.read(4096), b&#34;&#34;):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()</code></pre>
</details>
</dd>
<dt id="ki.functional.mkdir"><code class="name flex">
<span>def <span class="ident">mkdir</span></span>(<span>path: <a title="ki.types.NoPath" href="types.html#ki.types.NoPath">NoPath</a>) ‑> <a title="ki.types.EmptyDir" href="types.html#ki.types.EmptyDir">EmptyDir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Make a directory (with parents).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def mkdir(path: NoPath) -&gt; EmptyDir:
    &#34;&#34;&#34;Make a directory (with parents).&#34;&#34;&#34;
    path.mkdir(parents=True)
    return EmptyDir(path)</code></pre>
</details>
</dd>
<dt id="ki.functional.mkdtemp"><code class="name flex">
<span>def <span class="ident">mkdtemp</span></span>(<span>) ‑> <a title="ki.types.EmptyDir" href="types.html#ki.types.EmptyDir">EmptyDir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Make a temporary directory (in /tmp).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def mkdtemp() -&gt; EmptyDir:
    &#34;&#34;&#34;Make a temporary directory (in /tmp).&#34;&#34;&#34;
    return EmptyDir(tempfile.mkdtemp()).resolve()</code></pre>
</details>
</dd>
<dt id="ki.functional.mksubdir"><code class="name flex">
<span>def <span class="ident">mksubdir</span></span>(<span>directory: <a title="ki.types.EmptyDir" href="types.html#ki.types.EmptyDir">EmptyDir</a>, suffix: pathlib.Path) ‑> <a title="ki.types.EmptyDir" href="types.html#ki.types.EmptyDir">EmptyDir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Make a subdirectory of an empty directory (with parents).</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>EmptyDir</code></dt>
<dd>The created subdirectory.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def mksubdir(directory: EmptyDir, suffix: Path) -&gt; EmptyDir:
    &#34;&#34;&#34;
    Make a subdirectory of an empty directory (with parents).

    Returns
    -------
    EmptyDir
        The created subdirectory.
    &#34;&#34;&#34;
    subdir = directory / suffix
    subdir.mkdir(parents=True)
    directory.__class__ = Dir
    return EmptyDir(subdir.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.movetree"><code class="name flex">
<span>def <span class="ident">movetree</span></span>(<span>source: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, target: <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Call shutil.move().</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def movetree(source: Dir, target: NoFile) -&gt; Dir:
    &#34;&#34;&#34;Call shutil.move().&#34;&#34;&#34;
    shutil.move(source, target)
    return Dir(target.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.parent"><code class="name flex">
<span>def <span class="ident">parent</span></span>(<span>path: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>]) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Get the parent of a path that exists.
If the path points to the filesystem
root, we return itself.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def parent(path: Union[File, Dir]) -&gt; Dir:
    &#34;&#34;&#34;
    Get the parent of a path that exists.  If the path points to the filesystem
    root, we return itself.
    &#34;&#34;&#34;
    if is_root(path):
        return Dir(path.resolve())
    return Dir(path.parent)</code></pre>
</details>
</dd>
<dt id="ki.functional.part"><code class="name flex">
<span>def <span class="ident">part</span></span>(<span>p: collections.abc.Callable[[~T], bool], xs: collections.abc.Iterable[~T]) ‑> tuple[collections.abc.Iterable[~T], collections.abc.Iterable[~T]]</span>
</code></dt>
<dd>
<div class="desc"><p>Partition a list on a boolean predicate (Trues, Falses).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def part(p: Callable[[T], bool], xs: Iterable[T]) -&gt; Tuple[Iterable[T], Iterable[T]]:
    &#34;&#34;&#34;Partition a list on a boolean predicate (Trues, Falses).&#34;&#34;&#34;
    return reduce(lambda s, x: s[not p(x)].append(x) or s, xs, ([], []))</code></pre>
</details>
</dd>
<dt id="ki.functional.progressbar"><code class="name flex">
<span>def <span class="ident">progressbar</span></span>(<span>xs: collections.abc.Iterable[~T], s: str) ‑> collections.abc.Iterable[~T]</span>
</code></dt>
<dd>
<div class="desc"><p>Print a progress bar for an iterable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def progressbar(xs: Iterable[T], s: str) -&gt; Iterable[T]:
    &#34;&#34;&#34;Print a progress bar for an iterable.&#34;&#34;&#34;
    ys: Iterable[T] = tqdm(xs, ncols=80)
    ys.set_description(s)
    return ys</code></pre>
</details>
</dd>
<dt id="ki.functional.red"><code class="name flex">
<span>def <span class="ident">red</span></span>(<span>s: str) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print a message to the console in red.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def red(s: str) -&gt; None:
    &#34;&#34;&#34;Print a message to the console in red.&#34;&#34;&#34;
    print(f&#34;{Fore.RED}{s}{Style.RESET_ALL}&#34;)</code></pre>
</details>
</dd>
<dt id="ki.functional.rev_exists"><code class="name flex">
<span>def <span class="ident">rev_exists</span></span>(<span>repo: git.repo.base.Repo, rev: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Check if git commit reference exists in repository.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def rev_exists(repo: git.Repo, rev: str) -&gt; bool:
    &#34;&#34;&#34;Check if git commit reference exists in repository.&#34;&#34;&#34;
    try:
        repo.git.rev_parse(&#34;--verify&#34;, rev)
    except git.GitCommandError:
        return False
    return True</code></pre>
</details>
</dd>
<dt id="ki.functional.rglob"><code class="name flex">
<span>def <span class="ident">rglob</span></span>(<span>d: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, pattern: str) ‑> list[<a title="ki.types.File" href="types.html#ki.types.File">File</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Call d.rglob() and returns only files.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def rglob(d: Dir, pattern: str) -&gt; List[File]:
    &#34;&#34;&#34;Call d.rglob() and returns only files.&#34;&#34;&#34;
    files = filter(lambda p: isinstance(p, File), map(F.chk, d.rglob(pattern)))
    return list(files)</code></pre>
</details>
</dd>
<dt id="ki.functional.rmsm"><code class="name flex">
<span>def <span class="ident">rmsm</span></span>(<span>repo: git.repo.base.Repo, sm: git.objects.submodule.base.Submodule) ‑> git.objects.commit.Commit</span>
</code></dt>
<dd>
<div class="desc"><p>Remove a git submodule.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@curried
@beartype
def rmsm(repo: git.Repo, sm: git.Submodule) -&gt; git.Commit:
    &#34;&#34;&#34;Remove a git submodule.&#34;&#34;&#34;
    # Remove the submodule root and delete its .git directory.
    sm_root = Path(sm.module().working_tree_dir)
    repo.git.rm(sm_root, cached=True)
    dotgit = F.chk(sm_root / GIT)
    if isinstance(dotgit, Dir):
        F.rmtree(dotgit)
    else:
        dotgit.unlink(missing_ok=True)

    # Directory `sm_root` should still exist after `git.rm()` call.
    repo.git.add(sm_root)
    return repo.index.commit(f&#34;Add submodule `{sm.name}` as ordinary directory.&#34;)</code></pre>
</details>
</dd>
<dt id="ki.functional.rmtree"><code class="name flex">
<span>def <span class="ident">rmtree</span></span>(<span>target: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a></span>
</code></dt>
<dd>
<div class="desc"><p>Equivalent to <code>shutil.rmtree()</code>, but annihilates read-only files on Windows.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def rmtree(target: Dir) -&gt; NoFile:
    &#34;&#34;&#34;Equivalent to `shutil.rmtree()`, but annihilates read-only files on Windows.&#34;&#34;&#34;
    rmtree2(str(target))
    return NoFile(target)</code></pre>
</details>
</dd>
<dt id="ki.functional.rmtree2"><code class="name flex">
<span>def <span class="ident">rmtree2</span></span>(<span>path: str) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>On windows, rmtree fails for readonly dirs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rmtree2(path: str) -&gt; None:
    &#34;&#34;&#34;On windows, rmtree fails for readonly dirs.&#34;&#34;&#34;

    def handle_remove_readonly(
        func: Callable[..., Any],
        path: str,
        exc: Tuple[Type[OSError], OSError, TracebackType],
    ) -&gt; None:
        excvalue = exc[1]
        if func in (os.rmdir, os.remove, os.unlink) and excvalue.errno == errno.EACCES:
            for p in (path, os.path.dirname(path)):
                os.chmod(p, os.stat(p).st_mode | stat.S_IWUSR)
            func(path)
        else:
            raise excvalue

    shutil.rmtree(path, ignore_errors=False, onerror=handle_remove_readonly)</code></pre>
</details>
</dd>
<dt id="ki.functional.root"><code class="name flex">
<span>def <span class="ident">root</span></span>(<span>repo: git.repo.base.Repo) ‑> <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a></span>
</code></dt>
<dd>
<div class="desc"><p>Get working directory of a repo.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def root(repo: git.Repo) -&gt; Dir:
    &#34;&#34;&#34;Get working directory of a repo.&#34;&#34;&#34;
    return Dir(repo.working_dir).resolve()</code></pre>
</details>
</dd>
<dt id="ki.functional.shallow_walk"><code class="name flex">
<span>def <span class="ident">shallow_walk</span></span>(<span>directory: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> tuple[<a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, list[<a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>], list[<a title="ki.types.File" href="types.html#ki.types.File">File</a>]]</span>
</code></dt>
<dd>
<div class="desc"><p>Walk only the top-level directory with <code>os.walk()</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@functools.cache
@beartype
def shallow_walk(
    directory: Dir,
) -&gt; Tuple[Dir, List[Dir], List[File]]:
    &#34;&#34;&#34;Walk only the top-level directory with `os.walk()`.&#34;&#34;&#34;
    # pylint: disable=redefined-outer-name
    root, dirs, files = next(os.walk(directory))
    root = Dir(root)
    dirs = [Dir(root / d) for d in dirs]
    # TODO: Treat symlinks.
    files = [File(root / f) for f in files]
    return root, dirs, files</code></pre>
</details>
</dd>
<dt id="ki.functional.singleton"><code class="name flex">
<span>def <span class="ident">singleton</span></span>(<span>name: str) ‑> <a title="ki.types.Singleton" href="types.html#ki.types.Singleton">Singleton</a></span>
</code></dt>
<dd>
<div class="desc"><p>Removes all forward slashes and returns a Singleton pathlib.Path.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def singleton(name: str) -&gt; Singleton:
    &#34;&#34;&#34;Removes all forward slashes and returns a Singleton pathlib.Path.&#34;&#34;&#34;
    return Singleton(name.replace(&#34;/&#34;, &#34;&#34;))</code></pre>
</details>
</dd>
<dt id="ki.functional.slugify"><code class="name flex">
<span>def <span class="ident">slugify</span></span>(<span>value: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Taken from [1]. Convert spaces or repeated dashes to single dashes. Remove
characters that aren't alphanumerics, underscores, or hyphens. Convert to
lowercase. Also strip leading and trailing whitespace, dashes, and
underscores.</p>
<p>[1] <a href="https://github.com/django/django/blob/master/django/utils/text.py">https://github.com/django/django/blob/master/django/utils/text.py</a></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def slugify(value: str) -&gt; str:
    &#34;&#34;&#34;
    Taken from [1]. Convert spaces or repeated dashes to single dashes. Remove
    characters that aren&#39;t alphanumerics, underscores, or hyphens. Convert to
    lowercase. Also strip leading and trailing whitespace, dashes, and
    underscores.

    [1] https://github.com/django/django/blob/master/django/utils/text.py
    &#34;&#34;&#34;
    value = unicodedata.normalize(&#34;NFKC&#34;, value)
    value = re.sub(SLUG_REGEX, &#34;&#34;, value.lower())
    return re.sub(r&#34;[-\s]+&#34;, &#34;-&#34;, value).strip(&#34;-_&#34;)</code></pre>
</details>
</dd>
<dt id="ki.functional.starfilter"><code class="name flex">
<span>def <span class="ident">starfilter</span></span>(<span>f: collections.abc.Callable[[typing.Any, ...], bool], xs: collections.abc.Iterable[tuple[typing.Any, ...]]) ‑> collections.abc.Iterable[tuple[typing.Any, ...]]</span>
</code></dt>
<dd>
<div class="desc"><p>Filter an iterable, automatically unpacking tuple arguments.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def starfilter(
    f: Callable[[Any, ...], bool], xs: Iterable[Tuple[Any, ...]]
) -&gt; Iterable[Tuple[Any, ...]]:
    &#34;&#34;&#34;Filter an iterable, automatically unpacking tuple arguments.&#34;&#34;&#34;
    return filter(lambda x: f(*x), xs)</code></pre>
</details>
</dd>
<dt id="ki.functional.symlink"><code class="name flex">
<span>def <span class="ident">symlink</span></span>(<span>path: <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>, target: pathlib.Path) ‑> Union[<a title="ki.types.Link" href="types.html#ki.types.Link">Link</a>, <a title="ki.types.WindowsLink" href="types.html#ki.types.WindowsLink">WindowsLink</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Link <code>path</code> to <code>target</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def symlink(path: NoFile, target: Path) -&gt; Union[Link, WindowsLink]:
    &#34;&#34;&#34;Link `path` to `target`.&#34;&#34;&#34;
    if sys.platform == &#34;win32&#34;:
        with open(path, &#34;w&#34;, encoding=&#34;UTF-8&#34;) as f:
            f.write(str(target.as_posix()))
            return WindowsLink(path)

    # Treat POSIX systems.
    os.symlink(target, path)
    return Link(path)</code></pre>
</details>
</dd>
<dt id="ki.functional.touch"><code class="name flex">
<span>def <span class="ident">touch</span></span>(<span>directory: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>, name: str) ‑> <a title="ki.types.File" href="types.html#ki.types.File">File</a></span>
</code></dt>
<dd>
<div class="desc"><p>Touch a file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def touch(directory: Dir, name: str) -&gt; File:
    &#34;&#34;&#34;Touch a file.&#34;&#34;&#34;
    path = directory / singleton(name)
    path.touch()
    return File(path.resolve())</code></pre>
</details>
</dd>
<dt id="ki.functional.unlink"><code class="name flex">
<span>def <span class="ident">unlink</span></span>(<span>file: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.Link" href="types.html#ki.types.Link">Link</a>, <a title="ki.types.WindowsLink" href="types.html#ki.types.WindowsLink">WindowsLink</a>]) ‑> <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a></span>
</code></dt>
<dd>
<div class="desc"><p>Safely unlink a file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def unlink(file: Union[File, Link, WindowsLink]) -&gt; NoFile:
    &#34;&#34;&#34;Safely unlink a file.&#34;&#34;&#34;
    os.unlink(file)
    return NoFile(file)</code></pre>
</details>
</dd>
<dt id="ki.functional.unsubmodule"><code class="name flex">
<span>def <span class="ident">unsubmodule</span></span>(<span>repo: git.repo.base.Repo) ‑> git.repo.base.Repo</span>
</code></dt>
<dd>
<div class="desc"><p>Un-submodule all the git submodules (converts them to ordinary subdirs and
destroys commit history). Commit the changes to the main repository.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def unsubmodule(repo: git.Repo) -&gt; git.Repo:
    &#34;&#34;&#34;
    Un-submodule all the git submodules (converts them to ordinary subdirs and
    destroys commit history). Commit the changes to the main repository.
    &#34;&#34;&#34;
    _: List[git.Commit] = list(map(F.rmsm(repo), repo.submodules))
    gitmodules_file: Path = F.root(repo) / GITMODULES_FILE
    if gitmodules_file.exists():
        repo.git.rm(gitmodules_file)
        _ = repo.index.commit(&#34;Remove `.gitmodules` file.&#34;)
    return repo</code></pre>
</details>
</dd>
<dt id="ki.functional.walk"><code class="name flex">
<span>def <span class="ident">walk</span></span>(<span>directory: <a title="ki.types.Dir" href="types.html#ki.types.Dir">Dir</a>) ‑> frozenset[typing.Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.PseudoFile" href="types.html#ki.types.PseudoFile">PseudoFile</a>, <a title="ki.types.Link" href="types.html#ki.types.Link">Link</a>, <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>]]</span>
</code></dt>
<dd>
<div class="desc"><p>Get all file-like leaves in a directory, recursively.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def walk(
    directory: Dir,
) -&gt; FrozenSet[Union[File, PseudoFile, Link, NoFile]]:
    &#34;&#34;&#34;Get all file-like leaves in a directory, recursively.&#34;&#34;&#34;
    # pylint: disable=redefined-outer-name
    leaves = frozenset()
    for root, _, files in os.walk(directory):
        root = Dir(root)
        leaves |= frozenset({F.chk(root / f) for f in files})
    return leaves</code></pre>
</details>
</dd>
<dt id="ki.functional.write"><code class="name flex">
<span>def <span class="ident">write</span></span>(<span>path: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>], text: str) ‑> <a title="ki.types.File" href="types.html#ki.types.File">File</a></span>
</code></dt>
<dd>
<div class="desc"><p>Write text to a file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def write(path: Union[File, NoFile], text: str) -&gt; File:
    &#34;&#34;&#34;Write text to a file.&#34;&#34;&#34;
    with open(path, &#34;w+&#34;, encoding=&#34;UTF-8&#34;) as f:
        f.write(text)
    return File(path)</code></pre>
</details>
</dd>
<dt id="ki.functional.writeb"><code class="name flex">
<span>def <span class="ident">writeb</span></span>(<span>path: Union[<a title="ki.types.File" href="types.html#ki.types.File">File</a>, <a title="ki.types.NoFile" href="types.html#ki.types.NoFile">NoFile</a>], bs: bytes) ‑> <a title="ki.types.File" href="types.html#ki.types.File">File</a></span>
</code></dt>
<dd>
<div class="desc"><p>Write text to a file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def writeb(path: Union[File, NoFile], bs: bytes) -&gt; File:
    &#34;&#34;&#34;Write text to a file.&#34;&#34;&#34;
    with open(path, &#34;wb&#34;) as f:
        f.write(bs)
    return File(path)</code></pre>
</details>
</dd>
<dt id="ki.functional.yellow"><code class="name flex">
<span>def <span class="ident">yellow</span></span>(<span>s: str) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print a message to the console in yellow.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype
def yellow(s: str) -&gt; None:
    &#34;&#34;&#34;Print a message to the console in yellow.&#34;&#34;&#34;
    print(f&#34;{Fore.YELLOW}{s}{Style.RESET_ALL}&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="ki Home" href="index.html">
<img src="u1F367-shavedice.svg" alt=""> ki
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ki" href="index.html">ki</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="ki.functional.cat" href="#ki.functional.cat">cat</a></code></li>
<li><code><a title="ki.functional.chdir" href="#ki.functional.chdir">chdir</a></code></li>
<li><code><a title="ki.functional.chk" href="#ki.functional.chk">chk</a></code></li>
<li><code><a title="ki.functional.commitall" href="#ki.functional.commitall">commitall</a></code></li>
<li><code><a title="ki.functional.copyfile" href="#ki.functional.copyfile">copyfile</a></code></li>
<li><code><a title="ki.functional.copytree" href="#ki.functional.copytree">copytree</a></code></li>
<li><code><a title="ki.functional.curried" href="#ki.functional.curried">curried</a></code></li>
<li><code><a title="ki.functional.cwd" href="#ki.functional.cwd">cwd</a></code></li>
<li><code><a title="ki.functional.force_mkdir" href="#ki.functional.force_mkdir">force_mkdir</a></code></li>
<li><code><a title="ki.functional.get_batches" href="#ki.functional.get_batches">get_batches</a></code></li>
<li><code><a title="ki.functional.git_rm" href="#ki.functional.git_rm">git_rm</a></code></li>
<li><code><a title="ki.functional.gitd" href="#ki.functional.gitd">gitd</a></code></li>
<li><code><a title="ki.functional.init" href="#ki.functional.init">init</a></code></li>
<li><code><a title="ki.functional.is_empty" href="#ki.functional.is_empty">is_empty</a></code></li>
<li><code><a title="ki.functional.is_root" href="#ki.functional.is_root">is_root</a></code></li>
<li><code><a title="ki.functional.isfile" href="#ki.functional.isfile">isfile</a></code></li>
<li><code><a title="ki.functional.ki_rev_to_rev" href="#ki.functional.ki_rev_to_rev">ki_rev_to_rev</a></code></li>
<li><code><a title="ki.functional.md5" href="#ki.functional.md5">md5</a></code></li>
<li><code><a title="ki.functional.mkdir" href="#ki.functional.mkdir">mkdir</a></code></li>
<li><code><a title="ki.functional.mkdtemp" href="#ki.functional.mkdtemp">mkdtemp</a></code></li>
<li><code><a title="ki.functional.mksubdir" href="#ki.functional.mksubdir">mksubdir</a></code></li>
<li><code><a title="ki.functional.movetree" href="#ki.functional.movetree">movetree</a></code></li>
<li><code><a title="ki.functional.parent" href="#ki.functional.parent">parent</a></code></li>
<li><code><a title="ki.functional.part" href="#ki.functional.part">part</a></code></li>
<li><code><a title="ki.functional.progressbar" href="#ki.functional.progressbar">progressbar</a></code></li>
<li><code><a title="ki.functional.red" href="#ki.functional.red">red</a></code></li>
<li><code><a title="ki.functional.rev_exists" href="#ki.functional.rev_exists">rev_exists</a></code></li>
<li><code><a title="ki.functional.rglob" href="#ki.functional.rglob">rglob</a></code></li>
<li><code><a title="ki.functional.rmsm" href="#ki.functional.rmsm">rmsm</a></code></li>
<li><code><a title="ki.functional.rmtree" href="#ki.functional.rmtree">rmtree</a></code></li>
<li><code><a title="ki.functional.rmtree2" href="#ki.functional.rmtree2">rmtree2</a></code></li>
<li><code><a title="ki.functional.root" href="#ki.functional.root">root</a></code></li>
<li><code><a title="ki.functional.shallow_walk" href="#ki.functional.shallow_walk">shallow_walk</a></code></li>
<li><code><a title="ki.functional.singleton" href="#ki.functional.singleton">singleton</a></code></li>
<li><code><a title="ki.functional.slugify" href="#ki.functional.slugify">slugify</a></code></li>
<li><code><a title="ki.functional.starfilter" href="#ki.functional.starfilter">starfilter</a></code></li>
<li><code><a title="ki.functional.symlink" href="#ki.functional.symlink">symlink</a></code></li>
<li><code><a title="ki.functional.touch" href="#ki.functional.touch">touch</a></code></li>
<li><code><a title="ki.functional.unlink" href="#ki.functional.unlink">unlink</a></code></li>
<li><code><a title="ki.functional.unsubmodule" href="#ki.functional.unsubmodule">unsubmodule</a></code></li>
<li><code><a title="ki.functional.walk" href="#ki.functional.walk">walk</a></code></li>
<li><code><a title="ki.functional.write" href="#ki.functional.write">write</a></code></li>
<li><code><a title="ki.functional.writeb" href="#ki.functional.writeb">writeb</a></code></li>
<li><code><a title="ki.functional.yellow" href="#ki.functional.yellow">yellow</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>